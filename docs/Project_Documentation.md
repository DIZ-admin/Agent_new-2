# Agent Project Documentation

## Project Overview

The Agent project is an automated system for transferring photos between SharePoint libraries while enriching their metadata using artificial intelligence. The project is designed to streamline and automate the workflow for managing reference photos for a company called ERNI, particularly focusing on construction and architectural photography.

### Core Functionality

1. **Automated Transfer**: Moves photos from a source SharePoint library to a destination library
2. **Metadata Extraction**: Extracts EXIF data and other metadata from photos
3. **AI-Powered Analysis**: Uses OpenAI's GPT-4 Vision to analyze photos and generate relevant metadata
4. **Metadata Enrichment**: Combines EXIF data with AI analysis to create comprehensive metadata
5. **SharePoint Integration**: Uploads photos with enhanced metadata to the target SharePoint library
6. **Verification**: Validates successful transfers and generates reports

## System Architecture

The system follows a modular architecture with these main components:

### Backend Components (Python)

1. **SharePoint Authentication Module** (`sharepoint_auth.py`)
   - Manages connection and authentication to SharePoint
   - Used by all other modules that interact with SharePoint

2. **Metadata Schema Analyzer** (`metadata_schema.py`)
   - Extracts metadata schema from the target SharePoint library
   - Saves schema to JSON for use by other modules

3. **Photo Metadata Extractor** (`photo_metadata.py`)
   - Downloads photos from source SharePoint library
   - Extracts EXIF and other metadata
   - Saves photos to local storage

4. **OpenAI Analyzer** (`openai_analyzer.py`)
   - Analyzes photos using OpenAI's GPT-4 Vision
   - Generates metadata based on visual content
   - Follows the target SharePoint library schema

5. **Metadata Generator** (`metadata_generator.py`)
   - Combines EXIF data with OpenAI analysis
   - Formats metadata according to SharePoint requirements

6. **SharePoint Uploader** (`sharepoint_uploader.py`)
   - Uploads photos with metadata to target SharePoint library
   - Manages file naming and organization

7. **Transfer Verification** (`transfer_verification.py`)
   - Validates successful transfers
   - Generates reports on the process

8. **Auto Process Orchestrator** (`auto_process.py`)
   - Orchestrates the entire workflow
   - Runs all scripts in sequence
   - Manages logging and error handling

### Frontend Components (Flask/Jinja2)

The web interface is built with Flask and Jinja2 templates, providing components for:

1. **Dashboard** (`templates/main/index.html`) - Overview and quick access to functions
2. **Photos Management** (`templates/photos/index.html`, `templates/photos/analysis.html`) - Photo viewing and analysis
3. **Processes Management** (`templates/processes/index.html`, `templates/processes/view.html`) - Process monitoring
4. **Settings Management** (`templates/settings/index.html`) - System configuration
5. **Logs Viewing** - Log monitoring and management

## Data Flow

1. The system retrieves metadata schema from the target SharePoint library
2. Photos are downloaded from the source SharePoint library
3. EXIF metadata is extracted from the photos
4. Photos are analyzed using OpenAI's GPT-4 Vision
5. Metadata is generated by combining EXIF data and OpenAI analysis
6. Photos with enriched metadata are uploaded to the target SharePoint library
7. The system verifies successful transfers and generates reports

## Project Structure

```
/
├── config/                  # Configuration files
│   ├── config.env           # Environment variables
│   ├── sharepoint_choices.json  # SharePoint metadata schema
│   ├── default_prompt.env   # Default OpenAI prompt
│   ├── optimized_prompt.env # Optimized OpenAI prompt
│   ├── step_by_step_prompt.env # Step-by-step OpenAI prompt
│   └── structured_simple_prompt.env # Structured simple OpenAI prompt
├── data/                    # Data storage
│   ├── downloads/           # Downloaded photos
│   ├── metadata/            # Extracted metadata
│   ├── analysis/            # OpenAI analysis results
│   ├── upload/              # Files prepared for upload
│   │   └── metadata/        # Metadata for upload
│   ├── uploaded/            # Successfully uploaded files
│   ├── processed/           # Processed files
│   ├── registry/            # File registry
│   └── reports/             # Transfer reports
├── docs/                    # Documentation
├── logs/                    # Log files
├── src/                     # Python source code
│   ├── auto_process.py      # Orchestration script
│   ├── metadata_generator.py # Metadata generation
│   ├── metadata_schema.py   # Schema analyzer
│   ├── openai_analyzer.py   # AI photo analysis
│   ├── photo_metadata.py    # Photo metadata extraction
│   ├── process_wrapper.py   # Process wrapper
│   ├── sharepoint_auth.py   # SharePoint authentication
│   ├── sharepoint_uploader.py # SharePoint upload
│   ├── transfer_verification.py # Verification
│   ├── web_server.py        # Web server
│   ├── utils/               # Utility modules
│   │   ├── api.py           # API utilities
│   │   ├── config.py        # Configuration utilities
│   │   ├── logging.py       # Logging utilities
│   │   ├── paths.py         # Path utilities
│   │   ├── process_tracker.py # Process tracking
│   │   ├── registry.py      # File registry
│   │   └── sharepoint.py    # SharePoint utilities
│   └── web/                 # Web interface (Flask)
│       ├── app.py           # Flask application
│       ├── file_cache.py    # File caching
│       ├── file_manager.py  # File management
│       ├── process_monitor.py # Process monitoring
│       ├── templates/       # HTML templates
│       │   ├── base.html    # Base template
│       │   ├── main/        # Main templates
│       │   ├── photos/      # Photo templates
│       │   ├── processes/   # Process templates
│       │   └── settings/    # Settings templates
│       └── views/           # View functions
│           ├── logs.py      # Logs views
│           ├── main.py      # Main views
│           ├── photos.py    # Photo views
│           ├── processes.py # Process views
│           └── settings.py  # Settings views
└── tests/                   # Test files
```

## Configuration

The system is configured through environment variables in `config.env`:

- **SharePoint Connection**: Site URL, username, password
- **Library Settings**: Source and target library names
- **File Settings**: Metadata schema file, target filename mask, max file size
- **OpenAI Settings**: API key, concurrency limit, max tokens

## Key Technologies

- **Backend**: Python with libraries for SharePoint integration (Office365-REST-Python-Client), image processing (Pillow), and AI (OpenAI API)
- **Frontend**: Flask, Jinja2 templates, Bootstrap 5, jQuery
- **Storage**: Local filesystem (temporary) and SharePoint (permanent)
- **APIs**: SharePoint REST API, OpenAI API

## OpenAI Integration

The OpenAI analyzer is a key component that:

1. Takes photos as input
2. Sends them to OpenAI's GPT-4 Vision model with a specialized prompt
3. Instructs the AI to analyze the photos from a construction/architectural perspective
4. Generates metadata following the target SharePoint library schema
5. Processes the AI's response into a structured format
6. Saves the analysis results for further processing

The prompt engineering is specifically tailored to extract relevant construction and architectural details from the photos.

## SharePoint Integration

The system interfaces with SharePoint through:

1. **Authentication**: OAuth flow for secure access
2. **Schema Analysis**: Dynamic extraction of the metadata schema
3. **Photo Download**: Efficient retrieval from the source library
4. **Metadata Upload**: Properly formatted metadata submission
5. **Verification**: Confirmation of successful transfers

## Usage Flow

1. The system authenticates with SharePoint
2. It analyzes the target SharePoint library schema
3. It downloads photos from the source library
4. It extracts EXIF metadata from the photos
5. It analyzes photos with OpenAI
6. It generates enriched metadata
7. It uploads photos with metadata to the target library
8. It verifies successful transfers and generates reports

The process can be run automatically through the orchestrator script or step-by-step for more control.
