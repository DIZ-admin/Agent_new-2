# Веб-интерфейс ERNI Photo Processor

## Обзор

Веб-интерфейс ERNI Photo Processor предоставляет удобный способ управления процессом обработки фотографий через браузер. Он позволяет запускать различные модули системы, просматривать статистику, управлять фотографиями, просматривать логи и настраивать систему.

## Запуск веб-интерфейса

### Через Docker Compose

Самый простой способ запустить веб-интерфейс - использовать Docker Compose:

```bash
docker-compose up -d
```

После запуска веб-интерфейс будет доступен по адресу [http://localhost:8080](http://localhost:8080).

### Запуск вручную

Если вы хотите запустить веб-интерфейс без Docker, вы можете использовать следующую команду:

```bash
python -m src.web_server
```

После запуска веб-интерфейс будет доступен по адресу [http://localhost:5000](http://localhost:5000).

## Основные функции

### Дашборд

Дашборд предоставляет общую статистику системы и быстрый доступ к основным функциям:

- **Статистика**: количество фотографий в разных стадиях обработки
- **Запуск процессов**: кнопки для запуска различных модулей системы
- **Недавняя активность**: список последних обработанных и загруженных фотографий

### Управление фотографиями

Раздел "Фотографии" позволяет управлять фотографиями в системе:

- **Вкладка "Загрузки"**: фотографии, загруженные из SharePoint
- **Вкладка "Анализ"**: результаты анализа фотографий с помощью OpenAI
- **Вкладка "Загрузка"**: фотографии, подготовленные для загрузки в SharePoint
- **Вкладка "Загружено"**: фотографии, успешно загруженные в SharePoint
- **Просмотр фотографий**: просмотр фотографий и их метаданных
- **Просмотр анализа**: просмотр результатов анализа фотографий с помощью OpenAI

### Логи

Раздел "Логи" позволяет просматривать и управлять логами системы:

- **Просмотр логов**: просмотр логов системы в обратном хронологическом порядке (новые сверху)
- **Загрузка логов**: загрузка логов для анализа
- **Ротация логов**: удаление старых логов

### Процессы

Раздел "Процессы" позволяет запускать и мониторить процессы обработки:

- **Запуск процессов**: запуск различных модулей системы
- **Мониторинг процессов**: отслеживание статуса выполнения процессов
- **Просмотр результатов**: просмотр результатов выполнения процессов

### Настройки

Раздел "Настройки" позволяет настраивать систему:

- **Настройки SharePoint**: настройка подключения к SharePoint
- **Настройки OpenAI**: настройка подключения к OpenAI
- **Настройки промптов для OpenAI**: выбор и просмотр промптов для анализа фотографий
- **Настройки параметров модели OpenAI**: настройка модели, температуры, максимального количества токенов и уровня детализации
- **Настройки логирования**: настройка уровня логирования и имени файла лога
- **Очистка директорий**: удаление файлов из различных директорий
- **Очистка всех данных**: удаление всех файлов из всех директорий с данными

## Технические детали

Веб-интерфейс реализован с использованием следующих технологий:

- **Flask**: веб-фреймворк для Python
- **Flask-WTF**: расширение Flask для работы с формами и CSRF-защитой
- **Bootstrap 5**: фреймворк для создания адаптивного интерфейса
- **jQuery**: библиотека JavaScript для упрощения работы с DOM
- **Font Awesome**: библиотека иконок
- **DataTables**: плагин jQuery для создания интерактивных таблиц

Веб-интерфейс запускается в отдельном контейнере Docker и имеет доступ к тем же данным, что и основной процесс обработки фотографий.

## Безопасность

Веб-интерфейс защищен от CSRF-атак с помощью токенов, но не имеет встроенной аутентификации и авторизации. Рекомендуется использовать его только в защищенной сети или настроить внешний механизм аутентификации (например, с помощью прокси-сервера).

## Особенности реализации

### Промпты для OpenAI

Веб-интерфейс позволяет выбирать различные типы промптов для анализа фотографий с помощью OpenAI API. Промпты хранятся в отдельных файлах в директории `config/prompts/`. Каждый файл содержит настройки для определенного типа промпта.

На странице настроек можно выбрать тип промпта и просмотреть его содержимое. После сохранения настроек выбранный тип промпта будет использоваться для анализа фотографий.

### Параметры модели OpenAI

Веб-интерфейс позволяет настраивать параметры модели OpenAI:

- **Модель**: выбор модели OpenAI для анализа фотографий (например, gpt-4o)
- **Температура**: настройка креативности модели (от 0 до 1)
- **Максимальное количество токенов**: ограничение длины ответа модели
- **Уровень детализации**: настройка уровня детализации анализа изображений (auto, low, high)

### Очистка данных

Веб-интерфейс предоставляет функции для очистки данных:

- **Очистка отдельных директорий**: удаление файлов из выбранной директории
- **Очистка всех данных**: удаление всех файлов из всех директорий с данными
- **Очистка кэша**: очистка кэша файлов и перезагрузка реестра

## Расширение функциональности

Веб-интерфейс можно расширить, добавив новые функции:

- **Аутентификация и авторизация**: добавление системы пользователей с разными уровнями доступа
- **Редактирование метаданных**: возможность редактирования метаданных фотографий перед загрузкой в SharePoint
- **Редактирование промптов**: возможность редактирования промптов для OpenAI через веб-интерфейс
- **Мониторинг в реальном времени**: отображение статуса выполнения процессов в реальном времени с использованием WebSocket
- **API**: создание API для интеграции с другими системами
- **Горячая перезагрузка**: реализация горячей перезагрузки для разработки
